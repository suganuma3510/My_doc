# アクセス制御するためのDB設計

- [アクセス制御するためのDB設計](#アクセス制御するためのdb設計)
  - [権限の方式](#権限の方式)
    - [1\. 管理者フラグ方式](#1-管理者フラグ方式)
      - [データの例](#データの例)
      - [メリット](#メリット)
      - [デメリット](#デメリット)
    - [2\. ユーザー操作権限方式](#2-ユーザー操作権限方式)
      - [データの例](#データの例-1)
      - [メリット](#メリット-1)
      - [デメリット](#デメリット-1)
  - [参考](#参考)

## 権限の方式
### 1\. 管理者フラグ方式
ユーザーテーブルに直接、管理者の有無を判別するフラグを追加してアクセス制御を行う方式。


#### データの例
| 内部ID | ユーザー名 | …    | 管理者フラグ |
| :----- | :--------- | :--- | :----------- |
| 1      | admin      | …    | 1            |
| 2      | user1      | …    | 0            |
| 3      | user2      | …    | 0            |

※管理者：1、一般ユーザー：0

#### メリット
- シンプル
- テーブルの作成・管理が容易
- 画面に表示する、しないといった処理が容易

#### デメリット
- 特定の管理者にこの権限のみ付与するといった処理ができない

### 2\. ユーザー操作権限方式
ユーザーに個別に操作権限を付与する方式。

#### データの例
ユーザーテーブル
| 内部ID | ユーザー名 | …    |
| :----- | :--------- | :--- |
| 1      | admin      | …    |
| 2      | user1      | …    |
| 3      | user2      | …    |

ユーザー操作権限テーブル
| 内部ID | ユーザーID | 操作権限ID       |
| :----- | :--------- | :--------------- |
| 1      | 1 (admin)  | 1 (ユーザー管理) |
| 2      | 1 (〃)     | 2 (○○登録)       |
| 3      | 1 (〃)     | 3 (システム設定) |
| 4      | 2 (user1)  | 1 (ユーザー管理) |
| 5      | 2 (〃)     | 2 (○○登録)       |
| 6      | 2 (〃)     | 3 (システム設定) |

操作権限テーブル
| 内部ID | 権限名 (表示名) |
| :----- | :-------------- |
| 1      | ユーザー管理    |
| 2      | ○○登録          |
| 3      | システム設定    |
#### メリット
- 特定の管理者に別々の操作権限を付与できる
- 操作権限を増やしたい場合、DB 上のデータを増やすことで対応ができる

#### デメリット
-  操作権限が多くなってくる (10 以上など) と管理が面倒
-  複数のユーザー作成時に「一度に同じような複数の権限を設定したい」というケースでも1つずつ操作権限を設定しないといけないので使いづらい

## 参考
-   [システムのアクセス制御 \(操作権限管理\) 設計 \| knooto](https://knooto.info/software-design-access-control/)