# Composer

Composer は、PHP のプロジェクトが必要とするライブラリやパッケージを管理する「ライブラリ依存管理ツール」です。  
その PHP プロジェクトで必要なパッケージ(ライブラリ)は何かを列挙すると、それらを自動的にインストールしてくれる機能を持ちます。

Composer が優れている点は、パッケージの依存関係を解決してくれる点です。   例えば、プロジェクトには A というパッケージが必要だったとしましょう。   
しかし A を利用するためには B というライブラリが必要だとします。 手作業でライブラリを収集する場合は、このような依存関係を全て自らで解決しないといけませんが、Composer では利用するパッケージとして A を宣言すれば、自動的に B も含めてパッケージをインストールしてくれます。

## composerの利点

### リポジトリを汚さない

composerでインストールしたライブラリ群は一括で`vendor`というディレクトリに放り込まれているので、このディレクトリをignoreすることで、
ライブラリの依存性は別途作成されている`composer.json`に記載されるのみとなり、大量のライブラリでリポジトリが汚れることがなくなる。

### composer.lockで共有も高速

このcomposer.lockはcomposer.jsonにあるライブラリを取得するのに、実際にどのファイルを落としたのかをひとまとめにしたもの。

つまり、composer.lockがあるといちいち依存性を確かめることなく、初めにライブラリをインストールした人と同じファイル、バージョンのものをインストールすることができる。

### オートローダを吐き出せる

composerを使用してライブラリをインストールすると、`vendor/autoload.php`というファイルが生成され、このファイルを`require`することで、`vendor`配下のライブラリをオートロードできるように設定してくれる。

さらに、composer.jsonに以下の様な記述を追加することで、オートロードに設定を追加することができる。

```
    "autoload": {
        "psr-4": {
            "Niisan\\": "src/"
        }
    },
```

この設定は、`Niisan\`で始まる名前空間のオートロードをpsr-4にしたがって、`src/`配下で行うということです。  
例えば、`Niisan\Model\Class`という名前に対し、`src/model/Class.php`をオートロードするようになります。  
オートロードの設定を後から付け加えた場合は、`composer dump-autoload`としてやることで、`vendor/autoload.php`に設定を加える事ができます 

### コマンド一覧

#### init

composer使ったプロジェクトを自作するときに使うもの。

#### create-project

あるプロジェクトはプロジェクト作成時にテンプレートを用意してくれる場合があります  
モダンなフレームワークはこの`create-project`を使用してプロジェクトを生成してくれる場合が多いです。  
例えば、laravel, cake3, bearsunday, auraなどです。

laravelの場合は以下のコマンドでプロジェクトを作成できます

```
composer create-project --prefer-dist laravel/laravel blog
```

#### require

```
composer require <package>[:<tag>]
```

composerを使ってライブラリやパッケージをインストールします  
インストールされたライブラリの情報はcomposer.jsonに記載され、実際に何をインストールしたかの情報がcomposer.lockに記載されます  
composerを使っている場合はなるべく`composer require`を使用するようにしましょう

オプションとして`--dev`をつけると、開発環境専用のパッケージとしてインストールすることができます。  
これは、composer.jsonの中で、`require-dev`の項目に追加されるということです

#### install

composer.jsonに記載されている内容、もしくはcomposer.lockに記載されている内容に従って、パッケージをインストールします  
プロジェクトのメンバーは、このコマンドを使用することによって、パッケージの依存性を解決することができます。  
パッケージが更新されたら、再度このコマンドを打つといいでしょう

#### update

composer.lockを無視してパッケージをcomposer.jsonを元にインストールします  
現在の依存性を全部最新化したい時とかに使いますが、通常余り使う機会はないように思います。

#### remove

```
composer remove <package>
```

`require`の逆で、パッケージを取り除きます  
一応入れてみたけど、やっぱり使わないライブラリとかが出てきたら、こいつで取り除くといいでしょう。  
なんのために使うかわからないライブラリやパッケージがあるのは、あまり気持ちの良いものではないので

#### dump-autoload

先に述べた名前空間を吐き出させるコマンドです。  
composer.jsonにautoloadの項目を追加した場合はこのコマンドを使ってオートローダを刷新しておくと良いでしょう

composerを使うと、適宜見つけてきたパッケージを特に苦労することなく導入でき、本番適用やメンバーとの共有時も`composer install`一発で解決することができます。  
コードのメンテも外部ライブラリをcomposerに任せられるので、自分たちの書いたものだけに集中できるというものです

そんなわけで、やっぱりcomposer使った開発は楽です  
composerも名前空間もないコードをメンテすると、つくづくそう思います

#### 参考
[composer](https://getcomposer.org/)  
[PHPのライブラリ管理ツール「Composer」入門](https://weblabo.oscasierra.net/php-composer-1/)
[PHP開発でComposerを使わないなんてありえない！基礎編 \- Qiita](https://qiita.com/niisan-tokyo/items/8cccec88d45f38171c94)
